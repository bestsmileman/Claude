<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5í•™ë…„ 1ë°˜ ì¡°ì§ë„ - GoJS</title>
    <script src="https://unpkg.com/gojs/release/go.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #e0f7fa, #fff9c4);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
        }
        h1 {
            font-size: 26px;
            color: #37474f;
            margin-bottom: 20px;
        }
        #orgChartDiv {
            width: 900px;
            height: 520px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.1);
        }
        .btn-bar {
            margin-top: 16px;
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 22px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-copy {
            background: #42A5F5;
            color: white;
        }
        .btn-copy:hover { background: #1E88E5; }
        .btn-copy.copied {
            background: #66BB6A;
        }
        .btn-download {
            background: #FF7043;
            color: white;
        }
        .btn-download:hover { background: #E64A19; }
    </style>
</head>
<body>
    <h1>ğŸ“š ì´ˆë“±í•™êµ 5í•™ë…„ 1ë°˜ ì¡°ì§ë„</h1>
    <div id="orgChartDiv"></div>
    <div class="btn-bar">
        <button class="btn btn-copy" onclick="copySource()">ğŸ“‹ HTML ì†ŒìŠ¤ ë³µì‚¬</button>
        <button class="btn btn-download" onclick="downloadSource()">ğŸ’¾ HTML íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    </div>

    <script>
        function downloadSource() {
            const src = document.documentElement.outerHTML;
            const full = "<!DOCTYPE html>\n" + src;
            const blob = new Blob([full], { type: "text/html;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "org_chart.html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copySource() {
            const src = document.documentElement.outerHTML;
            const full = "<!DOCTYPE html>\n" + src;
            navigator.clipboard.writeText(full).then(function() {
                const btn = document.querySelector('.btn-copy');
                btn.textContent = "âœ… ë³µì‚¬ ì™„ë£Œ!";
                btn.classList.add("copied");
                setTimeout(function() {
                    btn.textContent = "ğŸ“‹ HTML ì†ŒìŠ¤ ë³µì‚¬";
                    btn.classList.remove("copied");
                }, 2000);
            });
        }

        const $ = go.GraphObject.make;

        const diagram = $(go.Diagram, "orgChartDiv", {
            "undoManager.isEnabled": true,
            "linkingTool.isEnabled": true,
            "linkingTool.portGravity": 60,
            "relinkingTool.isEnabled": true,
            "relinkingTool.portGravity": 60,
            "relinkingTool.fromHandleArchetype":
                $(go.Shape, "Diamond", { desiredSize: new go.Size(10, 10), fill: "#FF7043", stroke: "#E64A19", cursor: "pointer" }),
            "relinkingTool.toHandleArchetype":
                $(go.Shape, "Diamond", { desiredSize: new go.Size(10, 10), fill: "#42A5F5", stroke: "#1565C0", cursor: "pointer" }),
            layout: $(go.TreeLayout, {
                treeStyle: go.TreeStyle.LastParents,
                arrangement: go.TreeArrangement.Horizontal,
                angle: 90,
                layerSpacing: 50,
                nodeSpacing: 30
            }),
            initialContentAlignment: go.Spot.Center,
            initialAutoScale: go.AutoScale.Uniform
        });

        // ë…¸ë“œ ìƒ‰ìƒ ë§¤í•‘
        function getNodeColor(role) {
            if (role === "ë‹´ì„ì„ ìƒë‹˜") return { bg: "#FFEBEE", border: "#EF5350", text: "#C62828" };
            if (role === "ê¸‰ì¥")       return { bg: "#E3F2FD", border: "#42A5F5", text: "#1565C0" };
            return                            { bg: "#E8F5E9", border: "#66BB6A", text: "#2E7D32" };
        }

        // ì•„ì´ì½˜ ë§¤í•‘
        function getIcon(role) {
            if (role === "ë‹´ì„ì„ ìƒë‹˜") return "ğŸ‘©â€ğŸ«";
            if (role === "ê¸‰ì¥")       return "â­";
            if (role === "ë¯¸í™”ë°˜ì¥")   return "ğŸ§¹";
            if (role === "ì²´ìœ¡ë°˜ì¥")   return "âš½";
            if (role === "ë¬¸í™”ë°˜ì¥")   return "ğŸµ";
            return "ğŸ“Œ";
        }

        // ì—°ê²°ì (í¬íŠ¸) ìƒì„± í•¨ìˆ˜ - í° íˆíŠ¸ ì˜ì—­ + ì‹œê° í”¼ë“œë°±
        function makePort(name, spot, output, input) {
            return $(go.Shape, "Circle", {
                fill: "transparent",
                stroke: null,
                desiredSize: new go.Size(18, 18),
                alignment: spot,
                alignmentFocus: spot,
                portId: name,
                fromSpot: spot,
                toSpot: spot,
                fromLinkable: output,
                toLinkable: input,
                fromLinkableDuplicates: false,
                toLinkableDuplicates: false,
                cursor: "pointer",
                mouseEnter: function(e, port) {
                    if (!e.diagram.isReadOnly) {
                        port.fill = "#FF7043";
                        port.stroke = "#E64A19";
                        port.strokeWidth = 2;
                    }
                },
                mouseLeave: function(e, port) {
                    port.fill = "transparent";
                    port.stroke = null;
                    port.strokeWidth = 0;
                }
            });
        }

        diagram.nodeTemplate =
            $(go.Node, "Spot",
                {
                    cursor: "pointer",
                    locationSpot: go.Spot.Center,
                    movable: true,
                    selectionAdorned: true
                },
                new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                $(go.Panel, "Auto",
                    $(go.Shape, "RoundedRectangle",
                        {
                            strokeWidth: 2.5,
                            parameter1: 12,
                            fill: "white"
                        },
                        new go.Binding("fill", "role", function(r) { return getNodeColor(r).bg; }),
                        new go.Binding("stroke", "role", function(r) { return getNodeColor(r).border; })
                    ),
                    $(go.Panel, "Vertical",
                        { margin: new go.Margin(12, 20, 12, 20) },
                        $(go.TextBlock,
                            {
                                font: "28px sans-serif",
                                margin: new go.Margin(0, 0, 4, 0)
                            },
                            new go.Binding("text", "role", function(r) { return getIcon(r); })
                        ),
                        $(go.TextBlock,
                            {
                                font: "bold 13px 'Malgun Gothic', sans-serif",
                                margin: new go.Margin(0, 0, 4, 0)
                            },
                            new go.Binding("text", "role"),
                            new go.Binding("stroke", "role", function(r) { return getNodeColor(r).text; })
                        ),
                        $(go.TextBlock,
                            {
                                font: "bold 18px 'Malgun Gothic', sans-serif",
                                stroke: "#263238"
                            },
                            new go.Binding("text", "name")
                        )
                    )
                ),
                // ìƒí•˜ì¢Œìš° 4ê°œ ì—°ê²°ì 
                makePort("T", go.Spot.Top,    true, true),
                makePort("B", go.Spot.Bottom, true, true),
                makePort("L", go.Spot.Left,   true, true),
                makePort("R", go.Spot.Right,  true, true)
            );

        diagram.linkTemplate =
            $(go.Link,
                {
                    routing: go.Routing.Orthogonal,
                    corner: 5,
                    relinkableFrom: true,
                    relinkableTo: true,
                    reshapable: true,
                    resegmentable: true,
                    selectionAdornmentTemplate:
                        $(go.Adornment, "Link",
                            $(go.Shape, { isPanelMain: true, stroke: "#FF7043", strokeWidth: 4 })
                        ),
                    cursor: "pointer"
                },
                new go.Binding("fromPortId").makeTwoWay(),
                new go.Binding("toPortId").makeTwoWay(),
                new go.Binding("points").makeTwoWay(),
                $(go.Shape, { strokeWidth: 2.5, stroke: "#90A4AE" }),
                $(go.Shape, { toArrow: "Triangle", stroke: "#90A4AE", fill: "#90A4AE", scale: 1.2 })
            );

        diagram.model = new go.GraphLinksModel(
            // ë…¸ë“œ ë°ì´í„°
            [
                { key: 1, name: "",       role: "ë‹´ì„ì„ ìƒë‹˜" },
                { key: 2, name: "ê°€ê°€ê°€", role: "ê¸‰ì¥" },
                { key: 3, name: "ë‚˜ë‚˜ë‚˜", role: "ë¯¸í™”ë°˜ì¥" },
                { key: 4, name: "ë‹¤ë‹¤ë‹¤", role: "ì²´ìœ¡ë°˜ì¥" },
                { key: 5, name: "ë¼ë¼ë¼", role: "ë¬¸í™”ë°˜ì¥" }
            ],
            // ì—°ê²°ì„  ë°ì´í„°
            [
                { from: 1, to: 2, fromPortId: "B", toPortId: "T" },
                { from: 2, to: 3, fromPortId: "B", toPortId: "T" },
                { from: 2, to: 4, fromPortId: "B", toPortId: "T" },
                { from: 2, to: 5, fromPortId: "B", toPortId: "T" }
            ]
        );
    </script>
</body>
</html>
